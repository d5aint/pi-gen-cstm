#
# picom.conf (Optimized for Raspberry Pi 5 / LXDE)
#

#################################
#
# Backend & VSync
#
#################################

# Use the GLX (OpenGL) backend for hardware acceleration. This is key for the RPi 5.
backend = "glx";

# Enable VSync. This is the most important setting to prevent screen tearing.
vsync = true;

# Use EGL VSync, may be more efficient. (Default: false)
# use-egl-vsync = true;

# Use damage tracking to only redraw parts of the screen that have changed.
# This is a major performance optimization.
use-damage = true;

# Try to detect rounded corners and treat them as rectangular.
# Can save processing. (Default: true)
detect-rounded-corners = true;

#################################
#
# Shadows
#
#################################

# Enable shadows.
shadow = true;

# The blur radius for shadows. (Default: 12)
shadow-radius = 12;

# The opacity of shadows. (0.0 - 1.0, Default: 0.75)
shadow-opacity = 0.7;

# The left offset of shadows. (Default: -15)
shadow-offset-x = -10;

# The top offset of shadows. (Default: -15)
shadow-offset-y = -10;

# Avoid drawing shadows on certain windows.
shadow-exclude = [
  "name = 'Notification'",
  "class_g = 'Conky'",
  "class_g ?= 'Notify-osd'",
  "class_g = 'Cairo-clock'",
  "_NET_WM_STATE_STICKY",      # Ignore sticky windows (like lxpanel)
  "_NET_WM_WINDOW_TYPE_DOCK",  # Ignore docks
  "_PICOM_SHADOW = 1"          # Ignore picom's own shadow windows
];

#################################
#
# Fading
#
#################################

# Enable fading for windows (open, close, minimize).
fading = true;

# The time between steps in a fade (in milliseconds). (Default: 10)
# Lower is smoother but more CPU. 5 is a good balance.
fade-delta = 5;

# Opacity change in each fade step. (0.01 - 1.0, Default: 0.028)
fade-in-step = 0.03;
fade-out-step = 0.03;

# Don't fade on window open/close. (Default: false)
# no-fading-openclose = true;

# Do not fade menus, tooltips, etc.
fade-exclude = [
  "class_g = 'slop'",
  "class_g = 'lxpanel'"
];

#################################
#
# Opacity / Transparency
#
#################################

# Opacity of inactive windows. (0.1 - 1.0, Default: 1.0)
# This makes it easy to see which window is active.
inactive-opacity = 0.90;

# Opacity of active windows. (0.1 - 1.0, Default: 1.0)
active-opacity = 1.0;

# Opacity of window titlebars and borders. (0.1 - 1.0, Default: 1.0)
frame-opacity = 0.9;

# Let inactive opacity set by this file override window attributes. (Default: false)
inactive-opacity-override = false;

# Define opacity rules for specific applications.
# Syntax: "OPACITY:PATTERN"
# Example (uncomment to use):
# opacity-rule = [
#   "90:class_g = 'lxterminal' && focused",
#   "85:class_g = 'lxterminal' && !focused"
# ];

# Exclude opacity rules from specific windows.
opacity-rule-exclude = [
  "class_g = 'lxpanel'",
  "_NET_WM_STATE_FULLSCREEN" # Don't apply rules to fullscreen windows
];


#################################
#
# Rounded Corners
#
#################################

# Enable rounded corners for windows.
corner-radius = 8;

# Exclude rounded corners for specific windows.
# We MUST exclude the panel and fullscreen windows.
rounded-corners-exclude = [
  "class_g = 'lxpanel'",
  "_NET_WM_STATE_FULLSCREEN"
];

#################################
#
# Blur (Performance Intensive!)
#
#################################

# ---
# NOTE: Blur can be resource-intensive, even on an RPi 5.
# It is DISABLED by default. Uncomment the lines below to test it.
# If you experience lag, re-comment this section.
# ---

# blur: {
#  method = "dual_kawase"; # A good-looking, efficient blur
#  strength = 5;           # Blur strength (1-20)
#  background = false;
#  background-frame = false;
#  background-fixed = false;
#}

# Exclude blur from these windows.
# blur-background-exclude = [
#  "class_g = 'lxpanel'",
#  "_NET_WM_STATE_FULLSCREEN"
#];


#################################
#
# Window Types (Wintypes)
#
#################################

# This is an alternative way to set rules for specific window types.
# It's cleaner than using multiple ...-exclude lists.
wintypes:
{
  # LXPanel: Disable all effects.
  dock = {
    shadow = false;
    fade = false;
    corner-radius = 0;
  };

  # Menus & Tooltips: Disable shadows, prevent fading.
  dropdown_menu = { shadow = false; fade = false; };
  popup_menu    = { shadow = false; fade = false; };
  tooltip       = { shadow = true;  fade = true; opacity = 0.85; };

  # Fullscreen: Disable all effects.
  fullscreen = {
    shadow = false;
    fade = false;
    corner-radius = 0;
  };
};

